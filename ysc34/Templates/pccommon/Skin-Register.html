<%<hi:common_header runat="server" skinname="ascx/tags/Skin-Common_Header_logo2.ascx" />%>
<style>
    .gt_holder .gt_slider_knob {
        z-index: 0;
    }
</style>
<form runat="server" clientidmode="Static" id="aspnetForm">
    <div class="zhuce">
        <asp:HiddenField ID="hidIsValidateEmail" runat="server" ClientIDMode="Static"></asp:HiddenField>
        <%<asp:HiddenField ID="hidIsOpenGeetest" runat="server" ClientIDMode="Static" />%>
        <div><%<Hi:SmallStatusMessage id="Status" runat="server" Visible="False" />%></div>
        <div class="zhuce_con">
            <div class="zhuce_con_l">
                <div style="clear:both;"></div>
                <div>
                    <div class="zc_name">
                        <em id="utitle"><asp:literal runat="server" id="NameTitle">邮箱/手机</asp:literal></em>
                        <span><%<asp:TextBox ID="txtUserName" name="txtUserName" CssClass="zhuce_input1" runat="server" clientidmode="Static" tabindex="1" onblur="checkLength(this)" />%></span>
                        <script type="text/javascript">
                            var c;
                            function checkLength(thisObj) {
                                var value = thisObj.value;
                                if (value.trim().length == 0) return;
                                if ($("#utitle").html() == "邮箱") {
                                    validateRegExp.username = "^\\w+((-\\w+)|(\\.\\w+))*\\@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+$";
                                    validatePrompt.username.error.beUsed = "该邮箱已被使用，请更换，如果您是&quot;{1}&quot;，请<a href='/user/login.aspx' class='flk13'>登录</a>";
                                    validatePrompt.username.error.badFormat = "用户名只能用邮箱注册";
                                }
                                else if ($("#utitle").html() == "手机") {
                                    validateRegExp.username = /^0?(13|15|18|14|17|16|19)[0-9]{9}$/g;
                                    validatePrompt.username.error.beUsed = "该手机已被使用，请更换，如果您是&quot;{1}&quot;，请<a href='/user/login.aspx' class='flk13'>登录</a>";
                                    validatePrompt.username.error.badFormat = "用户名只能用手机注册";
                                }

                                if (c != value && c) {
                                    refreshCode();
                                    if (captchaObj) {
                                        captchaObj.refresh();
                                    }
                                }
                                c = value;
                                var r = /^0?(13|15|18|14|17|16|19)[0-9]{9}$/g;

                                if (r.test(value)) {
                                    $("#normaldiv").css("display", "block");
                                    if ($("#emimgcode").text() == "邮箱验证码") {
                                        refreshCode();
                                    }
                                    $("#txtNumber").val("");
                                    $("#emimgcode").text("图形验证码");
                                    if ($("#hidIsOpenGeetest").val() == "0") {
                                        $("#imgVerifyCode").show();
                                        $("#spanimagecode").show();
                                        $("#divimgcode").show();
                                        $("#divGeetest").hide();
                                    } else {
                                        $("#divimgcode").hide();
                                        $("#divGeetest").show();
                                    }

                                    $("#btnSendEmail").hide();
                                }
                                else {
                                    $("#normaldiv").css("display", "none");
                                    if ($("#hidIsOpenGeetest").val() == "0") {
                                        $("#divimgcode").show();
                                        $("#divGeetest").hide();
                                    } else {
                                        $("#divGeetest").show();
                                        $("#divimgcode").hide();
                                    }
                                    if ($("#hidIsValidateEmail").val() == "1") {
                                        $("#emimgcode").text("邮箱验证码");
                                        $("#divGeetest").css("display", "none");
                                        $("#imgVerifyCode").hide();
                                        $("#btnSendEmail").show();
                                        $("#spanimagecode").hide();
                                        $("#divimgcode").show();
                                        refreshCode2();
                                    }
                                }
                            }

                        </script>


                        <span id="txtUserName_succeed" class="zc_tishi">账号可用</span>
                        <span class="zc_tishi2" id="txtUserName_error"></span>
                    </div>
                    <div class="zc_name">
                        <em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;密码</em> <span>
                            <%<asp:TextBox ID="txtPassword" name="txtPassword" runat="server" clientidmode="Static" CssClass="zhuce_input1" TextMode="Password" tabindex="4" />%>
                        </span>
                        <span id="txtPassword_succeed" class="zc_tishi">密码可用</span>
                        <span class="zc_tishi2" id="txtPassword_error"></span>
                    </div>

                    <div class="zc_anquan" id="pwdstrength">
                        <em>密码安全度</em> <b></b>
                    </div>
                    <div></div>
                    <div class="zc_name">
                        <em>确认密码</em>
                        <span><%<asp:TextBox ID="txtPassword2" name="txtPassword2" clientidmode="Static" CssClass="zhuce_input1" runat="server" TextMode="Password" tabindex="5" />%></span>
                        <span id="txtPassword2_succeed" class="zc_tishi">密码输入正确</span>
                        <span class="zc_tishi2" id="txtPassword2_error"></span>
                    </div>
                    <div class="zc_name" id="divRealName" visible="false" runat="server" clientidmode="static">
                        <em>真实姓名</em>
                        <span>
                            <%<asp:TextBox ID="txtRealName" name="txtRealName" clientidmode="Static" CssClass="zhuce_input1" runat="server" tabindex="6" />%>
                        </span>
                        <span class="zc_tishi2" id="txtRealName_error"></span>
                    </div>
                    <div class="zc_name" id="divSex" runat="server" visible="false" clientidmode="static">
                        <em>性别</em>
                        <span>
                            <%<asp:RadioButton ID="chkMan" runat="server" Text="男士" class="icheck" Checked="true" GroupName="Sex" />%>
                            <%<asp:RadioButton ID="chkWoman" runat="server" Text="女士" class="icheck" GroupName="Sex" />%>
                        </span>
                        <span class="zc_tishi2" id="txtSex_error"></span>
                    </div>
                    <div class="zc_name" id="divBirthday" runat="server" visible="false" clientidmode="static">
                        <em>生日</em>
                        <span>
                            <%<Hi:CalendarPanel runat="server"   ClientIDMode="Static" ID="txtBirthday" name="txtBirthday" NotFloatLeft="true" IsEndDate="true"  tabindex="8" CssClass="zhuce_input1"></Hi:CalendarPanel> %>
                        </span>
                        <span class="zc_tishi2" id="txtBirthday_error"></span>
                    </div>
                    <div class="zc_name" id="divGeetest" runat="server" clientidmode="static">
                        <em id="utitle">滑动验证</em>
                        <span id="captcha"></span>
                    </div>
                    <div class="zc_name" id="divimgcode" runat="server" clientidmode="static">
                        <em class="yanzhengma" id="emimgcode">图形验证码</em>
                        <span><%<asp:TextBox ID="txtNumber" clientidmode="Static" CssClass="zhuce_input2" runat="server" MaxLength="4" autocomplete="off" tabindex="9" />%></span>
                        <div>
                            <span class="yanzheng_input2"><img id="imgVerifyCode" src='' style="vertical-align: middle; border-style: none;" alt="" /></span>
                            <span class="yanzheng_input4" id="spanimagecode">看不清？<a href="javascript:refreshCode();">换一张</a></span>
                            <span><input type="button" value="发送验证码" id="btnSendEmail" class="yanzheng_input3" style="display:none;" /></span>
                            <span id="txtNumber_succeed" class="zc_tishi">验证码输入正确</span>
                            <span class="zc_tishi2" id="txtNumber_error"></span>
                        </div>
                    </div>
                    <div class="zc_name" id="normaldiv" style="display:none;">
                        <em class="yanzhengma">短信验证码</em>
                        <span><%<asp:TextBox ID="txtPhoneCode" clientidmode="Static" CssClass="zhuce_input2" runat="server" MaxLength="4" autocomplete="off" tabindex="11" />%></span>
                        <div class="yanzheng_input2">
                            <span><input id="phoneVerifyCode" type="button" value="获取验证码" class="yanzheng_input3" /></span>
                        </div>
                        <span id="txtPhoneCode_succeed" class="zc_tishi">手机验证码输入正确</span>
                        <span class="zc_tishi2" id="txtPhoneCode_error"></span>
                    </div>
                    <div class="zc_xieyi">
                        <%<asp:CheckBox ID="chkAgree" name="chkAgree" CssClass="xy_xuanze" clientidmode="Static" runat="server" Checked="true" tabindex="12" />%><em>
                            我已阅读并同意<a href="RegisterAgreement.aspx"> 会员注册协议 </a>
                        </em>
                    </div>
                    <div>
                        <input type="button" value="" ID="btnRegister" name="btnRegister" runat="server" class="xieyi_btn" />
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" language="javascript">
        var imgVerifyCode = document.getElementById('imgVerifyCode');
        var captchaObj;
        if (imgVerifyCode) {
            document.getElementById('imgVerifyCode').src = "VerifyCodeImage.aspx";
        }

        if ($("#hidIsOpenGeetest").val() == "1") {
            var handler = function (obj) {
                // 将验证码加到id为captcha的元素里
                captchaObj = obj;
                obj.appendTo("#captcha");
            };
            $.ajax({
                // 获取id，challenge，success（是否启用failback）
                url: "/getcaptcha.aspx",
                type: "get",
                dataType: "json", // 使用jsonp格式
                success: function (data) {
                    // 使用initGeetest接口
                    // 参数1：配置参数，与创建Geetest实例时接受的参数一致
                    // 参数2：回调，回调的第一个参数验证码对象，之后可以使用它做appendTo之类的事件
                    initGeetest({
                        gt: data.gt,
                        challenge: data.challenge,
                        product: "float", // 产品形式
                        offline: !data.success
                    }, handler);
                }
            });
        }
        function refreshCode() {
            var img = document.getElementById("imgVerifyCode");

            if (img != null) {
                var currentDate = new Date();
                img.src = "VerifyCodeImage.aspx?t=" + currentDate.getTime();
            }
        }

        function refreshCode2() {
            var currentDate = new Date();
            var url = "VerifyCodeImage.aspx?t=" + currentDate.getTime();
            $.post(url);
        }

        $("#btnSendEmail").bind("click", function () {
            var tempemail = $("#txtUserName").val();
            var myreg = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*([a-zA-Z0-9])+\.([a-zA-Z]{1,4})$/;
            if (!myreg.test(tempemail)) {
                alert('请输入正确的邮箱');
                return false;
            }
            $.ajax({
                type: "POST",
                url: "/Handler/MemberHandler.ashx?action=VerficationEmail",
                contentType: "application/x-www-form-urlencoded; charset=utf-8",
                dataType: "json",
                data: { email: tempemail },
                success: function (result) {
                    if (result.success) {
                        alert(result.msg);
                    } else {
                        alert(result.msg);
                    }
                }
            });
        });

        $(document).ready(function () {

            $("#phoneVerifyCode").click(function () {
                if ($("#hidIsOpenGeetest").val() == "0" && $("#txtNumber").val().length == 0) {
                    alert("请输入图形验证码");
                    return;
                }
                var phone = document.getElementById("txtUserName").value;
                var imgCode = $("#txtNumber").val();

                $.ajax({
                    type: "POST",
                    url: "Handler/MemberHandler.ashx?action=SendRegisterPhoneCode",
                    //data: { Phone: phone, imgCode: imgCode },
                    data: $("#aspnetForm").serialize() + "&Phone=" + phone + "&imgCode=" + imgCode,
                    success: function (result) {
                        if (result.success == "true") {

                            var time = 1000;
                            var interval;
                            var count = 0;

                            function fun() {

                                count++;

                                if (count >= 60) {
                                    $("#phoneVerifyCode").attr("disabled", false);
                                    $("#phoneVerifyCode").attr("value", "重新发送");

                                    clearInterval(interval);
                                }
                                else {
                                    $("#phoneVerifyCode").attr("value", "发送成功（" + (60 - count) + ")");
                                }
                            }

                            $("#phoneVerifyCode").attr("disabled", "true");
                            interval = setInterval(fun, time);
                        }
                        else {
                            alert(result.msg);
                        }
                    }
                });

            });
        });

    </script>


    <script type="text/javascript" src="/Utility/validate/Validate.js?v=3.3.5"></script>
    <script src="Utility/gt.js"></script>

    <%<hi:common_footer runat="server" skinname="ascx/tags/Skin-Common_Footer_logo.ascx" />%>
</form>
